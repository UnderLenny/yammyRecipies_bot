import { Context } from "telegraf";
import { fetchRecipes } from "../services/apiService.js";

import { AxiosResponse } from "axios";
import { getRecipeMsgParams, translateText } from "../utils/helpers.js";

export async function recipes(ctx: Context): Promise<void> {
  try {
    const message = ctx.message as { text: string };
    const products = message.text.split("/recipes ")[1];

    console.log(products);

    const dishName = `–Ø —Ö–æ—á—É –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–ª—é–¥–æ —Å —ç—Ç–∏–º–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏: ${products}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –¢–û–õ–¨–ö–û –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞ –∏ –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ. –ï—Å–ª–∏ —Ç—ã –ø–æ–ª—É—á–∏–ª –∫–∞–∫–æ–µ-—Ç–æ –Ω–µ—Ä–∞–∑–±–æ—Ä—á–∏–≤–æ–µ, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–ª–∏ –Ω–µ –ø–æ —Ç–µ–º–µ –Ω–∞–∑–≤–∞–Ω–∏–µ. –¢–æ –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ(–•–º, —è –Ω–µ –∑–Ω–∞—é —Ç–∞–∫–∏—Ö –∏–Ω–≥—Ä–∏–¥–∏–µ–Ω—Ç–æ–≤, –Ω–æ –º–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–µ–±–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å ( –ø—Ä–æ—Å—Ç–µ–Ω—å–∫–æ–µ –±–ª—é–¥–æ)).`;
    const dishNameResponse: any = await fetchRecipes(dishName);
    console.log(dishNameResponse);
    if (
      dishNameResponse ===
        "–ö–∞–∫ —É –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤–æ–π —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —É –º–µ–Ω—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, –Ω–æ –ø–æ—á–µ–º—É-—Ç–æ —è —Å–æ–≤—Å–µ–º –Ω–µ —Ö–æ—á—É –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ —ç—Ç—É —Ç–µ–º—É." ||
      dishNameResponse ===
        "–ù–µ –ª—é–±–ª—é –º–µ–Ω—è—Ç—å —Ç–µ–º—É —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, –Ω–æ –≤–æ—Ç —Å–µ–π—á–∞—Å —Ç–æ—Ç —Å–∞–º—ã–π —Å–ª—É—á–∞–π." ||
      dishNameResponse ===
        "–ß—Ç–æ-—Ç–æ –≤ –≤–∞—à–µ–º –≤–æ–ø—Ä–æ—Å–µ –º–µ–Ω—è —Å–º—É—â–∞–µ—Ç. –ú–æ–∂–µ—Ç, –ø–æ–≥–æ–≤–æ—Ä–∏–º –Ω–∞ –¥—Ä—É–≥—É—é —Ç–µ–º—É?"
    ) {
      ctx.reply("–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è —Ç–∞–∫–æ–µ –Ω–µ–ª—å–∑—è –µ—Å—Ç—å");
    } else {
      const ingredients = `–Ø —Ö–æ—á—É –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–ª—é–¥–æ: ${dishNameResponse}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ –∏–Ω–≥—Ä–∏–¥–∏–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.`;
      const ingredientsResponse: any = await fetchRecipes(ingredients);
      const recipe = `–Ø —Ö–æ—á—É –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–ª—é–¥–æ: ${dishNameResponse}, –ø–æ —ç—Ç–∏–º –∏–Ω–≥—Ä–∏–¥–∏–µ–Ω—Ç–∞–º ${ingredientsResponse}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ, —Ç–æ–ª—å–∫–æ —Ä–µ—Ü–µ–ø—Ç —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å —ç—Ç–æ –±–ª—é–¥–æ. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.`;
      const recipeResponse: string = (await fetchRecipes(recipe)) ?? "";
      ctx.reply(
        `–Ø –¥—É–º–∞—é —Ç–µ–±–µ –º–æ–∂–µ—Ç –ø–æ–Ω—Ä–∞–≤–∏—Ç—å—Å—è:\n${dishNameResponse}üòã\n\n –õ–æ–≤–∏ –∏–Ω–≥—Ä–∏–¥–∏–µ–Ω—Ç—ã: \n${ingredientsResponse}\n\n –†–µ—Ü–µ–ø—Ç –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:\n${recipeResponse}`
      );
    }
  } catch (err) {
    console.error(err);
  }
}
